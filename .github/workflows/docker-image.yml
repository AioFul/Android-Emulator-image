name: docker push

on:
  workflow_dispatch:
    inputs:
      Tag:
        description: 'Select docker tag to push'     
        required: true
        default: 'nexus6_playstore' 
        type: choice
        options:
        - nexus6_playstore
        - pixelC_tablet_playstore

jobs:
  Pushing-docker-image:
    strategy:
      matrix:
        emulator: [ "pixel_c", "nexus6" ]
        emulator_name: [ "pixel_c", "nexus" ]
        os: [ "ubuntu-latest", "windows-latest" ]
        arch: [ "linux-latest", "win-latest" ]
        dockerfile: [ "Dockerfile", "DockerfileWin" ]
        docker_tag: ["${{ github.event.inputs.Tag }}"]

    runs-on: ${{ matrix.os }}

    steps:
    - uses: actions/checkout@v2

    - name: Docker Login
      uses: docker/login-action@v2.1.0
      with:
        username: ${{secrets.DOCKER_USERNAME}}
        password: ${{secrets.DOCKER_PASSWORD}}

    - name: Docker build image
      run: docker build --build-arg EMULATOR_DEVICE="${{ matrix.emulator }}" --build-arg EMULATOR_NAME="${{ matrix.emulator_name }}" -t amrka/android-emulator:${{ matrix.docker_tag }}-${{ matrix.arch }} -f ${{ matrix.dockerfile }} .

    - name: Push docker image
      run:  docker push amrka/android-emulator:${{ matrix.docker_tag }}-${{ matrix.arch }}